$(document).ready((()=>{$("#CarsForCompany").on("change",(()=>{window.location="/Car/index?id="+$("#CarsForCompany").val()})),document.querySelectorAll('[name="status"]').forEach((e=>{e.addEventListener("click",doFiltering)})),carTimerJob(),jobTimer(),console.log("documentReady")})),$(".uppercase").on("keyup",(function(){let e=$(this).val();$(this).val(e.toUpperCase())}));const clearErrors=()=>{$(".validation-summary-errors").empty();for(var e=document.getElementsByClassName("text-danger"),n=0;n<e.length;n++)e[n].innerHTML=""},setupClearErrors=()=>{clearErrors();var e=document.getElementById("CreateForm");e&&e.addEventListener("mousedown",clearErrors)};document.addEventListener("DOMContentLoaded",setupClearErrors);const carTimerJob=()=>{const e=window.location.origin;$.ajax({url:`${e}/api/carapi/getallcars`,type:"GET",dataType:"json",success:n=>{if(0===n.length)return setTimeout((()=>carTimerJob()),1e3),void console.log("No cars were found!");let t=n[Math.floor(Math.random()*n.length)];if(!0===t.disabled)return void console.log(t.regNr+" is blocked for updating of Online/Offline!");t.online=!t.online,$.ajax({url:`${e}/api/carapi/updateonline`,contentType:"application/json",type:"POST",data:JSON.stringify(t),dataType:"json",success:e=>{},error:e=>{}});const o=`#${t.id} td:eq(2)`,s=`#${t.id+"_2"} td:eq(3)`,r="#"+(t.id+"_3");!0===t.online?($(o).text("Online"),$(o).removeClass("alert-danger"),$(s).text("Online"),$(s).removeClass("alert-danger"),$(r).text("Online"),$(r).removeClass("alert-danger"),console.log(t.regNr+" is Online!")):($(o).text("Offline"),$(o).addClass("alert-danger"),$(s).text("Offline"),$(s).addClass("alert-danger"),$(r).text("Offline"),$(r).addClass("alert-danger"),console.log(t.regNr+" is Offline!")),null!==document.getElementById("All")&&doFiltering()}}),setTimeout((()=>carTimerJob()),500)},doFiltering=()=>{let e=0,n=document.getElementById("All");!1===n.checked&&(n=document.getElementById("Online"),e=!0===n.checked?1:2);var t=$("#cars > tbody");$("tr",t).each((function(){$(this).removeClass("hidden");let n=$("td:eq(2)",$(this)).html();void 0!==n&&(n=n.trim()),"Offline"===n&&1===e&&$(this).addClass("hidden"),"Online"===n&&2===e&&$(this).addClass("hidden")}))};let oldJobs={};const jobTimer=()=>{const e=window.location.origin;$.ajax({url:`${e}/api/jobstatus/getalljobs`,type:"GET",dataType:"json",success:e=>{0===Object.keys(e).length?console.log("No jobs found!"):Object.entries(e).forEach((([e,n])=>{oldJobs[e]&&oldJobs[e].status===n.status||setJobStatus(e,n.status)})),oldJobs=e},error:(e,n,t)=>{console.error("AJAX call failed: ",n,t)}}),setTimeout((()=>jobTimer()),1e3)};function setJobStatus(e,n){const t=document.getElementById("job_"+e);if(t)if(t.innerHTML="","Running"===n){console.log("setJobStatus Spinner: ",e,n);const o='\n            <svg viewBox="0 0 800 800" xmlns="http://www.w3.org/2000/svg" width="60" height="60">\n                <style>\n                    @keyframes spin {\n                        to {\n                            transform: rotate(360deg);\n                        }\n                    }\n\n                    @keyframes spin2 {\n                        0% {\n                            stroke-dasharray: 1, 800;\n                            stroke-dashoffset: 0;\n                        }\n                        50% {\n                            stroke-dasharray: 400, 400;\n                            stroke-dashoffset: -200px;\n                        }\n                        100% {\n                            stroke-dasharray: 800, 1;\n                            stroke-dashoffset: -800px;\n                        }\n                    }\n\n                    .spin2 {\n                        transform-origin: center;\n                        animation: spin2 1.5s ease-in-out infinite,\n                        spin 2s linear infinite;\n                        animation-direction: alternate;\n                    }\n                </style>\n                <circle class="spin2" cx="400" cy="400" fill="none" r="200" stroke-width="50" stroke="#E387FF" stroke-dasharray="700 1400" stroke-linecap="round"></circle>\n            </svg>\n        ';t.innerHTML=o}else{const e=document.createElement("span");e.className="text-state",e.textContent=n,t.appendChild(e)}}